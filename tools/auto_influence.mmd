%% Auto-extracted Influence Spec
%% Solveil-tuned (empathy_score, Lyra.affection)
flowchart TD
  %% === Fixed scene order ===
  A1_S00_TUTO("tutorial")
  A1_S01_INTR("act1_intro")
  A1_S02_BEDR("act1_bedroom")
  A1_S02B_SECT("act1_sector7_mission")
  A1_S03_MORN("act1_morning_routine")
  A1_S04_HALL("act1_hallway")
  A1_S05_GALA("act1_gala")
  A1_S05B_DARE("act1_daren_flashback")
  A1_S06_BALC("act1_balcony")
  A1_S07_BEDR("act1_07_bedroom")
  A1_S07A_INSP("act1_inspection_day")
  A1_S07B_BARR("act1_barracks_morning")
  A1_S08_HILL("act1_hill")
  A1_S09_RITU("act1_ritual")
  A1_S09B_DEMO("act1_demo_floor")
  A1_S10_BROT("act1_brothers")
  A1_S10B_ARCH("act1_archive_merit")
  A1_S10C_DEBR("act1_debrief_theater")
  A1_S11_BREA("act1_breaking_point")
  A1_S12_LYRA("act1_lyra_visit")
  A1_S13_THE_("act1_the_message")
  A1_S14_LOWE("act1_lower_spans")
  A1_S15_ZIRA("act1_zira")
  A1_S16_RETU("act1_return_aeries")
  A1_S17_THE_("act1_sweep")
  A1_S18_CONF("act1_confession_lyra")
  A1_S18B_MORN("act1_morning_after_confession")
  A1_S19_OBSI("act1_obsidian_bridge")
  A1_S20_INVE("act1_investigation")
  A1_S21_PURG("act1_rooftop_reflection")
  A1_S00_TUTO --> A1_S01_INTR
  A1_S01_INTR --> A1_S02_BEDR
  A1_S02_BEDR --> A1_S02B_SECT
  A1_S02B_SECT --> A1_S03_MORN
  A1_S03_MORN --> A1_S04_HALL
  A1_S04_HALL --> A1_S05_GALA
  A1_S05_GALA --> A1_S05B_DARE
  A1_S05B_DARE --> A1_S06_BALC
  A1_S06_BALC --> A1_S07_BEDR
  A1_S07_BEDR --> A1_S07A_INSP
  A1_S07A_INSP --> A1_S07B_BARR
  A1_S07B_BARR --> A1_S08_HILL
  A1_S08_HILL --> A1_S09_RITU
  A1_S09_RITU --> A1_S09B_DEMO
  A1_S09B_DEMO --> A1_S10_BROT
  A1_S10_BROT --> A1_S10B_ARCH
  A1_S10B_ARCH --> A1_S10C_DEBR
  A1_S10C_DEBR --> A1_S11_BREA
  A1_S11_BREA --> A1_S12_LYRA
  A1_S12_LYRA --> A1_S13_THE_
  A1_S13_THE_ --> A1_S14_LOWE
  A1_S14_LOWE --> A1_S15_ZIRA
  A1_S15_ZIRA --> A1_S16_RETU
  A1_S16_RETU --> A1_S17_THE_
  A1_S17_THE_ --> A1_S18_CONF
  A1_S18_CONF --> A1_S18B_MORN
  A1_S18B_MORN --> A1_S19_OBSI
  A1_S19_OBSI --> A1_S20_INVE
  A1_S20_INVE --> A1_S21_PURG

  %% === Choices inside scenes ===
  C_A1_S02_SayItAnyway["Choice: Say it anyway"]:::choice
  A1_S02_BEDR --> C_A1_S02_SayItAnyway
  C_A1_S02_SayItAnyway -. "empathy_score -1" .-> G_EMPATHY_SCORE_3{"empathy_score >= 3"}:::gate
  C_A1_S02_SayItAnyway -. "empathy_score -1" .-> G_EMPATHY_SCORE_1{"empathy_score >= 1"}:::gate
  C_A1_S02_SayItAnyway -. "empathy_score -1" .-> G_EMPATHY_SCORE_2{"empathy_score >= 2"}:::gate
  C_A1_S02_StaySilent["Choice: Stay silent"]:::choice
  A1_S02_BEDR --> C_A1_S02_StaySilent
  C_A1_S02_StaySilent -. "empathy_score +1" .-> G_EMPATHY_SCORE_3{"empathy_score >= 3"}:::gate
  C_A1_S02_StaySilent -. "empathy_score +1" .-> G_EMPATHY_SCORE_1{"empathy_score >= 1"}:::gate
  C_A1_S02_StaySilent -. "empathy_score +1" .-> G_EMPATHY_SCORE_2{"empathy_score >= 2"}:::gate
  C_A1_S02_BuryIt["Choice: Bury it."]:::choice
  A1_S02B_SECT --> C_A1_S02_BuryIt
  C_A1_S02_BuryIt -. "empathy_score -1" .-> G_EMPATHY_SCORE_3{"empathy_score >= 3"}:::gate
  C_A1_S02_BuryIt -. "empathy_score -1" .-> G_EMPATHY_SCORE_1{"empathy_score >= 1"}:::gate
  C_A1_S02_BuryIt -. "empathy_score -1" .-> G_EMPATHY_SCORE_2{"empathy_score >= 2"}:::gate
  C_A1_S02_LetItStay["Choice: Let it stay."]:::choice
  A1_S02B_SECT --> C_A1_S02_LetItStay
  C_A1_S02_LetItStay -. "empathy_score +1" .-> G_EMPATHY_SCORE_3{"empathy_score >= 3"}:::gate
  C_A1_S02_LetItStay -. "empathy_score +1" .-> G_EMPATHY_SCORE_1{"empathy_score >= 1"}:::gate
  C_A1_S02_LetItStay -. "empathy_score +1" .-> G_EMPATHY_SCORE_2{"empathy_score >= 2"}:::gate
  C_A1_S03_LetYourselfRemember["Choice: Let yourself remember"]:::choice
  A1_S03_MORN --> C_A1_S03_LetYourselfRemember
  C_A1_S03_LetYourselfRemember -. "empathy_score +1" .-> G_EMPATHY_SCORE_3{"empathy_score >= 3"}:::gate
  C_A1_S03_LetYourselfRemember -. "empathy_score +1" .-> G_EMPATHY_SCORE_1{"empathy_score >= 1"}:::gate
  C_A1_S03_LetYourselfRemember -. "empathy_score +1" .-> G_EMPATHY_SCORE_2{"empathy_score >= 2"}:::gate
  C_A1_S03_BuryIt["Choice: Bury it"]:::choice
  A1_S03_MORN --> C_A1_S03_BuryIt
  C_A1_S03_BuryIt -. "empathy_score -1" .-> G_EMPATHY_SCORE_3{"empathy_score >= 3"}:::gate
  C_A1_S03_BuryIt -. "empathy_score -1" .-> G_EMPATHY_SCORE_1{"empathy_score >= 1"}:::gate
  C_A1_S03_BuryIt -. "empathy_score -1" .-> G_EMPATHY_SCORE_2{"empathy_score >= 2"}:::gate
  C_A1_S04_CoverIt["Choice: Cover it."]:::choice
  A1_S04_HALL --> C_A1_S04_CoverIt
  C_A1_S04_CoverIt -. "empathy_score -1" .-> G_EMPATHY_SCORE_3{"empathy_score >= 3"}:::gate
  C_A1_S04_CoverIt -. "empathy_score -1" .-> G_EMPATHY_SCORE_1{"empathy_score >= 1"}:::gate
  C_A1_S04_CoverIt -. "empathy_score -1" .-> G_EMPATHY_SCORE_2{"empathy_score >= 2"}:::gate
  C_A1_S04_LetItShow["Choice: Let it show."]:::choice
  A1_S04_HALL --> C_A1_S04_LetItShow
  C_A1_S04_LetItShow -. "empathy_score +1" .-> G_EMPATHY_SCORE_3{"empathy_score >= 3"}:::gate
  C_A1_S04_LetItShow -. "empathy_score +1" .-> G_EMPATHY_SCORE_1{"empathy_score >= 1"}:::gate
  C_A1_S04_LetItShow -. "empathy_score +1" .-> G_EMPATHY_SCORE_2{"empathy_score >= 2"}:::gate
  C_A1_S05_RespondWithCold["Choice: Respond with cold courtesy."]:::choice
  A1_S05_GALA --> C_A1_S05_RespondWithCold
  C_A1_S05_RespondWithCold -. "empathy_score -1" .-> G_EMPATHY_SCORE_3{"empathy_score >= 3"}:::gate
  C_A1_S05_RespondWithCold -. "empathy_score -1" .-> G_EMPATHY_SCORE_1{"empathy_score >= 1"}:::gate
  C_A1_S05_RespondWithCold -. "empathy_score -1" .-> G_EMPATHY_SCORE_2{"empathy_score >= 2"}:::gate
  C_A1_S05_AcknowledgeTheAwkwardness["Choice: Acknowledge the awkwardness."]:::choice
  A1_S05_GALA --> C_A1_S05_AcknowledgeTheAwkwardness
  C_A1_S05_AcknowledgeTheAwkwardness -. "empathy_score +1" .-> G_EMPATHY_SCORE_3{"empathy_score >= 3"}:::gate
  C_A1_S05_AcknowledgeTheAwkwardness -. "empathy_score +1" .-> G_EMPATHY_SCORE_1{"empathy_score >= 1"}:::gate
  C_A1_S05_AcknowledgeTheAwkwardness -. "empathy_score +1" .-> G_EMPATHY_SCORE_2{"empathy_score >= 2"}:::gate
  C_A1_S05_AcknowledgeHer["Choice: Acknowledge her."]:::choice
  A1_S05_GALA --> C_A1_S05_AcknowledgeHer
  C_A1_S05_LookAway["Choice: Look away."]:::choice
  A1_S05_GALA --> C_A1_S05_LookAway
  C_A1_S05_CrossTheFloor["Choice: Cross the floor toward her."]:::choice
  A1_S05_GALA --> C_A1_S05_CrossTheFloor
  C_A1_S05_CrossTheFloor -. "empathy_score +1" .-> G_EMPATHY_SCORE_3{"empathy_score >= 3"}:::gate
  C_A1_S05_CrossTheFloor -. "empathy_score +1" .-> G_EMPATHY_SCORE_1{"empathy_score >= 1"}:::gate
  C_A1_S05_CrossTheFloor -. "empathy_score +1" .-> G_EMPATHY_SCORE_2{"empathy_score >= 2"}:::gate
  C_A1_S05_KeepYourDistance["Choice: Keep your distance."]:::choice
  A1_S05_GALA --> C_A1_S05_KeepYourDistance
  C_A1_S06_LeanInAnd["Choice: Lean in and light it for her."]:::choice
  A1_S06_BALC --> C_A1_S06_LeanInAnd
  C_A1_S06_OfferTheLighter["Choice: Offer the lighter and step back."]:::choice
  A1_S06_BALC --> C_A1_S06_OfferTheLighter
  C_A1_S06_HoldHerGaze["Choice: Hold her gaze."]:::choice
  A1_S06_BALC --> C_A1_S06_HoldHerGaze
  C_A1_S06_LookPastHer["Choice: Look past her to the city."]:::choice
  A1_S06_BALC --> C_A1_S06_LookPastHer
  C_A1_S06_FlickAshOver["Choice: Flick ash over the rail."]:::choice
  A1_S06_BALC --> C_A1_S06_FlickAshOver
  C_A1_S06_TapAshInto["Choice: Tap ash into the tray."]:::choice
  A1_S06_BALC --> C_A1_S06_TapAshInto
  C_A1_S06_PressHerAbout["Choice: Press her about the leash she is on."]:::choice
  A1_S06_BALC --> C_A1_S06_PressHerAbout
  C_A1_S06_LetTheMoment["Choice: Let the moment breathe."]:::choice
  A1_S06_BALC --> C_A1_S06_LetTheMoment
  C_A1_S07_BreakItImmediately["Choice: Break it immediately."]:::choice
  A1_S07_BEDR --> C_A1_S07_BreakItImmediately
  C_A1_S07_HesitateForA["Choice: Hesitate for a breath."]:::choice
  A1_S07_BEDR --> C_A1_S07_HesitateForA
  C_A1_S07_HesitateForA -. "empathy_score +1" .-> G_EMPATHY_SCORE_3{"empathy_score >= 3"}:::gate
  C_A1_S07_HesitateForA -. "empathy_score +1" .-> G_EMPATHY_SCORE_1{"empathy_score >= 1"}:::gate
  C_A1_S07_HesitateForA -. "empathy_score +1" .-> G_EMPATHY_SCORE_2{"empathy_score >= 2"}:::gate
  C_A1_S07_SendASingle["Choice: Send a single-word acknowledgment: 'Received.'"]:::choice
  A1_S07_BEDR --> C_A1_S07_SendASingle
  C_A1_S07_SayNothing["Choice: Say nothing."]:::choice
  A1_S07_BEDR --> C_A1_S07_SayNothing
  C_A1_S07_SayNothing -. "empathy_score +1" .-> G_EMPATHY_SCORE_3{"empathy_score >= 3"}:::gate
  C_A1_S07_SayNothing -. "empathy_score +1" .-> G_EMPATHY_SCORE_1{"empathy_score >= 1"}:::gate
  C_A1_S07_SayNothing -. "empathy_score +1" .-> G_EMPATHY_SCORE_2{"empathy_score >= 2"}:::gate
  C_A1_S07_MercyReducesUnnecessary["Choice: Mercy reduces unnecessary harm while preserving mission integrity."]:::choice
  A1_S07A_INSP --> C_A1_S07_MercyReducesUnnecessary
  C_A1_S07_MercyReducesUnnecessary -. "empathy_score +1" .-> G_EMPATHY_SCORE_3{"empathy_score >= 3"}:::gate
  C_A1_S07_MercyReducesUnnecessary -. "empathy_score +1" .-> G_EMPATHY_SCORE_1{"empathy_score >= 1"}:::gate
  C_A1_S07_MercyReducesUnnecessary -. "empathy_score +1" .-> G_EMPATHY_SCORE_2{"empathy_score >= 2"}:::gate
  C_A1_S07_MercyIsDiscretionary["Choice: Mercy is discretionary lenience that risks mission drift."]:::choice
  A1_S07A_INSP --> C_A1_S07_MercyIsDiscretionary
  C_A1_S07_MercyIsDiscretionary -. "empathy_score -1" .-> G_EMPATHY_SCORE_3{"empathy_score >= 3"}:::gate
  C_A1_S07_MercyIsDiscretionary -. "empathy_score -1" .-> G_EMPATHY_SCORE_1{"empathy_score >= 1"}:::gate
  C_A1_S07_MercyIsDiscretionary -. "empathy_score -1" .-> G_EMPATHY_SCORE_2{"empathy_score >= 2"}:::gate
  C_A1_S07_MercyIsA["Choice: Mercy is a variable outside scope."]:::choice
  A1_S07A_INSP --> C_A1_S07_MercyIsA
  C_A1_S07_MercyIsA -. "empathy_score -1" .-> G_EMPATHY_SCORE_3{"empathy_score >= 3"}:::gate
  C_A1_S07_MercyIsA -. "empathy_score -1" .-> G_EMPATHY_SCORE_1{"empathy_score >= 1"}:::gate
  C_A1_S07_MercyIsA -. "empathy_score -1" .-> G_EMPATHY_SCORE_2{"empathy_score >= 2"}:::gate
  C_A1_S07_OccasionalSleepDisruption["Choice: Occasional sleep disruption. Manageable. Log it."]:::choice
  A1_S07A_INSP --> C_A1_S07_OccasionalSleepDisruption
  C_A1_S07_OccasionalSleepDisruption -. "empathy_score +1" .-> G_EMPATHY_SCORE_3{"empathy_score >= 3"}:::gate
  C_A1_S07_OccasionalSleepDisruption -. "empathy_score +1" .-> G_EMPATHY_SCORE_1{"empathy_score >= 1"}:::gate
  C_A1_S07_OccasionalSleepDisruption -. "empathy_score +1" .-> G_EMPATHY_SCORE_2{"empathy_score >= 2"}:::gate
  C_A1_S07_NoResidueMetrics["Choice: No residue. Metrics optimal."]:::choice
  A1_S07A_INSP --> C_A1_S07_NoResidueMetrics
  C_A1_S07_NoResidueMetrics -. "empathy_score -1" .-> G_EMPATHY_SCORE_3{"empathy_score >= 3"}:::gate
  C_A1_S07_NoResidueMetrics -. "empathy_score -1" .-> G_EMPATHY_SCORE_1{"empathy_score >= 1"}:::gate
  C_A1_S07_NoResidueMetrics -. "empathy_score -1" .-> G_EMPATHY_SCORE_2{"empathy_score >= 2"}:::gate
  C_A1_S07_NoReport["Choice: No report."]:::choice
  A1_S07A_INSP --> C_A1_S07_NoReport
  C_A1_S07_NoReport -. "empathy_score -1; empathy_score +1" .-> G_EMPATHY_SCORE_3{"empathy_score >= 3"}:::gate
  C_A1_S07_NoReport -. "empathy_score -1; empathy_score +1" .-> G_EMPATHY_SCORE_1{"empathy_score >= 1"}:::gate
  C_A1_S07_NoReport -. "empathy_score -1; empathy_score +1" .-> G_EMPATHY_SCORE_2{"empathy_score >= 2"}:::gate
  C_A1_S07_NeutralizeTargetImmediately["Choice: Neutralize target immediately. Collateral tolerance engaged."]:::choice
  A1_S07A_INSP --> C_A1_S07_NeutralizeTargetImmediately
  C_A1_S07_NeutralizeTargetImmediately -. "empathy_score -2" .-> G_EMPATHY_SCORE_3{"empathy_score >= 3"}:::gate
  C_A1_S07_NeutralizeTargetImmediately -. "empathy_score -2" .-> G_EMPATHY_SCORE_1{"empathy_score >= 1"}:::gate
  C_A1_S07_NeutralizeTargetImmediately -. "empathy_score -2" .-> G_EMPATHY_SCORE_2{"empathy_score >= 2"}:::gate
  C_A1_S07_CreateSeparationFirst["Choice: Create separation first: strobe, sound, angle; then isolate target."]:::choice
  A1_S07A_INSP --> C_A1_S07_CreateSeparationFirst
  C_A1_S07_CreateSeparationFirst -. "empathy_score +2" .-> G_EMPATHY_SCORE_3{"empathy_score >= 3"}:::gate
  C_A1_S07_CreateSeparationFirst -. "empathy_score +2" .-> G_EMPATHY_SCORE_1{"empathy_score >= 1"}:::gate
  C_A1_S07_CreateSeparationFirst -. "empathy_score +2" .-> G_EMPATHY_SCORE_2{"empathy_score >= 2"}:::gate
  C_A1_S07_RefusePremiseDemand["Choice: Refuse premise. Demand device verification before engagement."]:::choice
  A1_S07A_INSP --> C_A1_S07_RefusePremiseDemand
  C_A1_S07_RefusePremiseDemand -. "empathy_score +2" .-> G_EMPATHY_SCORE_3{"empathy_score >= 3"}:::gate
  C_A1_S07_RefusePremiseDemand -. "empathy_score +2" .-> G_EMPATHY_SCORE_1{"empathy_score >= 1"}:::gate
  C_A1_S07_RefusePremiseDemand -. "empathy_score +2" .-> G_EMPATHY_SCORE_2{"empathy_score >= 2"}:::gate
  C_A1_S07_Yes["Choice: Yes."]:::choice
  A1_S07A_INSP --> C_A1_S07_Yes
  C_A1_S07_Yes -. "empathy_score -1" .-> G_EMPATHY_SCORE_3{"empathy_score >= 3"}:::gate
  C_A1_S07_Yes -. "empathy_score -1" .-> G_EMPATHY_SCORE_1{"empathy_score >= 1"}:::gate
  C_A1_S07_Yes -. "empathy_score -1" .-> G_EMPATHY_SCORE_2{"empathy_score >= 2"}:::gate
  C_A1_S07_ILlAct["Choice: I'll act when it preserves life and objective."]:::choice
  A1_S07A_INSP --> C_A1_S07_ILlAct
  C_A1_S07_ILlAct -. "empathy_score +1" .-> G_EMPATHY_SCORE_3{"empathy_score >= 3"}:::gate
  C_A1_S07_ILlAct -. "empathy_score +1" .-> G_EMPATHY_SCORE_1{"empathy_score >= 1"}:::gate
  C_A1_S07_ILlAct -. "empathy_score +1" .-> G_EMPATHY_SCORE_2{"empathy_score >= 2"}:::gate
  C_A1_S07_QuietlyRestoreThe["Choice: Quietly restore the worker's ration chip while the guard looks away."]:::choice
  A1_S07B_BARR --> C_A1_S07_QuietlyRestoreThe
  C_A1_S07_QuietlyRestoreThe -. "empathy_score +1" .-> G_EMPATHY_SCORE_3{"empathy_score >= 3"}:::gate
  C_A1_S07_QuietlyRestoreThe -. "empathy_score +1" .-> G_EMPATHY_SCORE_1{"empathy_score >= 1"}:::gate
  C_A1_S07_QuietlyRestoreThe -. "empathy_score +1" .-> G_EMPATHY_SCORE_2{"empathy_score >= 2"}:::gate
  C_A1_S07_IgnoreItAnd["Choice: Ignore it and move forward in line."]:::choice
  A1_S07B_BARR --> C_A1_S07_IgnoreItAnd
  C_A1_S07_TellTheGuard["Choice: Tell the guard to advance priority flow per protocol."]:::choice
  A1_S07B_BARR --> C_A1_S07_TellTheGuard
  C_A1_S07_TellTheGuard -. "empathy_score -1" .-> G_EMPATHY_SCORE_3{"empathy_score >= 3"}:::gate
  C_A1_S07_TellTheGuard -. "empathy_score -1" .-> G_EMPATHY_SCORE_1{"empathy_score >= 1"}:::gate
  C_A1_S07_TellTheGuard -. "empathy_score -1" .-> G_EMPATHY_SCORE_2{"empathy_score >= 2"}:::gate
  C_A1_S07_TeachHimA["Choice: Teach him a humane frame: 'Stabilize civilians first; then pursue objective.'"]:::choice
  A1_S07B_BARR --> C_A1_S07_TeachHimA
  C_A1_S07_TeachHimA -. "empathy_score +1" .-> G_EMPATHY_SCORE_3{"empathy_score >= 3"}:::gate
  C_A1_S07_TeachHimA -. "empathy_score +1" .-> G_EMPATHY_SCORE_1{"empathy_score >= 1"}:::gate
  C_A1_S07_TeachHimA -. "empathy_score +1" .-> G_EMPATHY_SCORE_2{"empathy_score >= 2"}:::gate
  C_A1_S07_TeachHimThe["Choice: Teach him the clinical script: 'Neutralize; collateral within tolerance.'"]:::choice
  A1_S07B_BARR --> C_A1_S07_TeachHimThe
  C_A1_S07_TeachHimThe -. "empathy_score -1" .-> G_EMPATHY_SCORE_3{"empathy_score >= 3"}:::gate
  C_A1_S07_TeachHimThe -. "empathy_score -1" .-> G_EMPATHY_SCORE_1{"empathy_score >= 1"}:::gate
  C_A1_S07_TeachHimThe -. "empathy_score -1" .-> G_EMPATHY_SCORE_2{"empathy_score >= 2"}:::gate
  C_A1_S07_TellHimTo["Choice: Tell him to keep his head down and copy senior phrasing."]:::choice
  A1_S07B_BARR --> C_A1_S07_TellHimTo
  C_A1_S09_TakeTheClean["Choice: Take the clean shot — center mass, no drift."]:::choice
  A1_S09B_DEMO --> C_A1_S09_TakeTheClean
  C_A1_S09_TakeTheClean -. "empathy_score -2" .-> G_EMPATHY_SCORE_3{"empathy_score >= 3"}:::gate
  C_A1_S09_TakeTheClean -. "empathy_score -2" .-> G_EMPATHY_SCORE_1{"empathy_score >= 1"}:::gate
  C_A1_S09_TakeTheClean -. "empathy_score -2" .-> G_EMPATHY_SCORE_2{"empathy_score >= 2"}:::gate
  C_A1_S09_DisruptTheLight["Choice: Disrupt the light — force them to move, then isolate."]:::choice
  A1_S09B_DEMO --> C_A1_S09_DisruptTheLight
  C_A1_S09_DisruptTheLight -. "empathy_score +1" .-> G_EMPATHY_SCORE_3{"empathy_score >= 3"}:::gate
  C_A1_S09_DisruptTheLight -. "empathy_score +1" .-> G_EMPATHY_SCORE_1{"empathy_score >= 1"}:::gate
  C_A1_S09_DisruptTheLight -. "empathy_score +1" .-> G_EMPATHY_SCORE_2{"empathy_score >= 2"}:::gate
  C_A1_S09_RequestIdVerification["Choice: Request ID verification — refuse to engage without confirmation."]:::choice
  A1_S09B_DEMO --> C_A1_S09_RequestIdVerification
  C_A1_S09_RequestIdVerification -. "empathy_score +2" .-> G_EMPATHY_SCORE_3{"empathy_score >= 3"}:::gate
  C_A1_S09_RequestIdVerification -. "empathy_score +2" .-> G_EMPATHY_SCORE_1{"empathy_score >= 1"}:::gate
  C_A1_S09_RequestIdVerification -. "empathy_score +2" .-> G_EMPATHY_SCORE_2{"empathy_score >= 2"}:::gate
  C_A1_S10_AskAPointed["Choice: Ask a pointed question about evac corridors and casualty verification."]:::choice
  A1_S10B_ARCH --> C_A1_S10_AskAPointed
  C_A1_S10_AskAPointed -. "empathy_score +1" .-> G_EMPATHY_SCORE_3{"empathy_score >= 3"}:::gate
  C_A1_S10_AskAPointed -. "empathy_score +1" .-> G_EMPATHY_SCORE_1{"empathy_score >= 1"}:::gate
  C_A1_S10_AskAPointed -. "empathy_score +1" .-> G_EMPATHY_SCORE_2{"empathy_score >= 2"}:::gate
  C_A1_S10_ComplimentTheEfficiency["Choice: Compliment the efficiency of the pacification."]:::choice
  A1_S10B_ARCH --> C_A1_S10_ComplimentTheEfficiency
  C_A1_S10_ComplimentTheEfficiency -. "empathy_score -1" .-> G_EMPATHY_SCORE_3{"empathy_score >= 3"}:::gate
  C_A1_S10_ComplimentTheEfficiency -. "empathy_score -1" .-> G_EMPATHY_SCORE_1{"empathy_score >= 1"}:::gate
  C_A1_S10_ComplimentTheEfficiency -. "empathy_score -1" .-> G_EMPATHY_SCORE_2{"empathy_score >= 2"}:::gate
  C_A1_S10_SayNothingAnd["Choice: Say nothing and keep walking."]:::choice
  A1_S10B_ARCH --> C_A1_S10_SayNothingAnd
  C_A1_S10_AddAQuiet["Choice: Add a quiet line under your breath: 'Order without understanding is brittle.'"]:::choice
  A1_S10B_ARCH --> C_A1_S10_AddAQuiet
  C_A1_S10_AddAQuiet -. "empathy_score +1; Lyra.affection +1" .-> G_EMPATHY_SCORE_3{"empathy_score >= 3"}:::gate
  C_A1_S10_AddAQuiet -. "empathy_score +1; Lyra.affection +1" .-> G_EMPATHY_SCORE_1{"empathy_score >= 1"}:::gate
  C_A1_S10_AddAQuiet -. "empathy_score +1; Lyra.affection +1" .-> G_EMPATHY_SCORE_2{"empathy_score >= 2"}:::gate
  C_A1_S10_RepeatTheMaxims["Choice: Repeat the maxims exactly, for the room to hear."]:::choice
  A1_S10B_ARCH --> C_A1_S10_RepeatTheMaxims
  C_A1_S10_RepeatTheMaxims -. "empathy_score -1" .-> G_EMPATHY_SCORE_3{"empathy_score >= 3"}:::gate
  C_A1_S10_RepeatTheMaxims -. "empathy_score -1" .-> G_EMPATHY_SCORE_1{"empathy_score >= 1"}:::gate
  C_A1_S10_RepeatTheMaxims -. "empathy_score -1" .-> G_EMPATHY_SCORE_2{"empathy_score >= 2"}:::gate
  C_A1_S10_DeflectWithA["Choice: Deflect with a neutral 'We continue.'"]:::choice
  A1_S10B_ARCH --> C_A1_S10_DeflectWithA
  C_A1_S10_RecommendEvacCorridors["Choice: Recommend evac corridors and comms windows in dense sectors (humane optimization)."]:::choice
  A1_S10C_DEBR --> C_A1_S10_RecommendEvacCorridors
  C_A1_S10_RecommendEvacCorridors -. "empathy_score +1" .-> G_EMPATHY_SCORE_3{"empathy_score >= 3"}:::gate
  C_A1_S10_RecommendEvacCorridors -. "empathy_score +1" .-> G_EMPATHY_SCORE_1{"empathy_score >= 1"}:::gate
  C_A1_S10_RecommendEvacCorridors -. "empathy_score +1" .-> G_EMPATHY_SCORE_2{"empathy_score >= 2"}:::gate
  C_A1_S10_PubliclyAffirmCollateral["Choice: Publicly affirm collateral tolerance and decisive action."]:::choice
  A1_S10C_DEBR --> C_A1_S10_PubliclyAffirmCollateral
  C_A1_S10_PubliclyAffirmCollateral -. "empathy_score -1" .-> G_EMPATHY_SCORE_3{"empathy_score >= 3"}:::gate
  C_A1_S10_PubliclyAffirmCollateral -. "empathy_score -1" .-> G_EMPATHY_SCORE_1{"empathy_score >= 1"}:::gate
  C_A1_S10_PubliclyAffirmCollateral -. "empathy_score -1" .-> G_EMPATHY_SCORE_2{"empathy_score >= 2"}:::gate
  C_A1_S10_StaySilentMeet["Choice: Stay silent; meet Lyra's eyes across the tier."]:::choice
  A1_S10C_DEBR --> C_A1_S10_StaySilentMeet
  C_A1_S11_StepForward["Choice: Step forward"]:::choice
  A1_S11_BREA --> C_A1_S11_StepForward
  C_A1_S11_StepBack["Choice: Step back"]:::choice
  A1_S11_BREA --> C_A1_S11_StepBack
  C_A1_S12_TellHerTo["Choice: Tell her to leave"]:::choice
  A1_S12_LYRA --> C_A1_S12_TellHerTo
  C_A1_S12_LetLyraStay["Choice: Let Lyra stay"]:::choice
  A1_S12_LYRA --> C_A1_S12_LetLyraStay
  C_A1_S13_OpenTheMessage["Choice: Open the message."]:::choice
  A1_S13_THE_ --> C_A1_S13_OpenTheMessage
  C_A1_S13_Hesitate["Choice: Hesitate."]:::choice
  A1_S13_THE_ --> C_A1_S13_Hesitate
  C_A1_S13_Hesitate -. "empathy_score +1" .-> G_EMPATHY_SCORE_3{"empathy_score >= 3"}:::gate
  C_A1_S13_Hesitate -. "empathy_score +1" .-> G_EMPATHY_SCORE_1{"empathy_score >= 1"}:::gate
  C_A1_S13_Hesitate -. "empathy_score +1" .-> G_EMPATHY_SCORE_2{"empathy_score >= 2"}:::gate
  C_A1_S13_OpenTheUnmarked["Choice: Open the unmarked message."]:::choice
  A1_S13_THE_ --> C_A1_S13_OpenTheUnmarked
  C_A1_S13_IgnoreItAnd["Choice: Ignore it and read Marcus’s order again."]:::choice
  A1_S13_THE_ --> C_A1_S13_IgnoreItAnd
  C_A1_S13_GoToThe["Choice: Go to the Lower Spans now."]:::choice
  A1_S13_THE_ --> C_A1_S13_GoToThe
  C_A1_S13_GoToThe -. "empathy_score +1" .-> G_EMPATHY_SCORE_3{"empathy_score >= 3"}:::gate
  C_A1_S13_GoToThe -. "empathy_score +1" .-> G_EMPATHY_SCORE_1{"empathy_score >= 1"}:::gate
  C_A1_S13_GoToThe -. "empathy_score +1" .-> G_EMPATHY_SCORE_2{"empathy_score >= 2"}:::gate
  C_A1_S13_WaitAndThink["Choice: Wait and think it through."]:::choice
  A1_S13_THE_ --> C_A1_S13_WaitAndThink
  C_A1_S14_BuyACup["Choice: Buy a cup."]:::choice
  A1_S14_LOWE --> C_A1_S14_BuyACup
  C_A1_S14_WalkPastWithout["Choice: Walk past without stopping."]:::choice
  A1_S14_LOWE --> C_A1_S14_WalkPastWithout
  C_A1_S14_TryToReassure["Choice: Try to reassure the child."]:::choice
  A1_S14_LOWE --> C_A1_S14_TryToReassure
  C_A1_S14_TryToReassure -. "empathy_score +1" .-> G_EMPATHY_SCORE_3{"empathy_score >= 3"}:::gate
  C_A1_S14_TryToReassure -. "empathy_score +1" .-> G_EMPATHY_SCORE_1{"empathy_score >= 1"}:::gate
  C_A1_S14_TryToReassure -. "empathy_score +1" .-> G_EMPATHY_SCORE_2{"empathy_score >= 2"}:::gate
  C_A1_S14_SayNothingAnd["Choice: Say nothing and keep walking."]:::choice
  A1_S14_LOWE --> C_A1_S14_SayNothingAnd
  C_A1_S14_NodInAcknowledgment["Choice: Nod in acknowledgment."]:::choice
  A1_S14_LOWE --> C_A1_S14_NodInAcknowledgment
  C_A1_S14_NodInAcknowledgment -. "empathy_score +1" .-> G_EMPATHY_SCORE_3{"empathy_score >= 3"}:::gate
  C_A1_S14_NodInAcknowledgment -. "empathy_score +1" .-> G_EMPATHY_SCORE_1{"empathy_score >= 1"}:::gate
  C_A1_S14_NodInAcknowledgment -. "empathy_score +1" .-> G_EMPATHY_SCORE_2{"empathy_score >= 2"}:::gate
  C_A1_S14_StepBackInto["Choice: Step back into shadow."]:::choice
  A1_S14_LOWE --> C_A1_S14_StepBackInto
  C_A1_S15_StopHer["Choice: Stop her"]:::choice
  A1_S15_ZIRA --> C_A1_S15_StopHer
  C_A1_S15_LetHerGo["Choice: Let her go"]:::choice
  A1_S15_ZIRA --> C_A1_S15_LetHerGo
  C_A1_S16_EnterImmediately["Choice: Enter immediately."]:::choice
  A1_S16_RETU --> C_A1_S16_EnterImmediately
  C_A1_S16_EnterImmediately -. "empathy_score -1" .-> G_EMPATHY_SCORE_3{"empathy_score >= 3"}:::gate
  C_A1_S16_EnterImmediately -. "empathy_score -1" .-> G_EMPATHY_SCORE_1{"empathy_score >= 1"}:::gate
  C_A1_S16_EnterImmediately -. "empathy_score -1" .-> G_EMPATHY_SCORE_2{"empathy_score >= 2"}:::gate
  C_A1_S16_PauseAtThe["Choice: Pause at the threshold."]:::choice
  A1_S16_RETU --> C_A1_S16_PauseAtThe
  C_A1_S16_PauseAtThe -. "empathy_score +1" .-> G_EMPATHY_SCORE_3{"empathy_score >= 3"}:::gate
  C_A1_S16_PauseAtThe -. "empathy_score +1" .-> G_EMPATHY_SCORE_1{"empathy_score >= 1"}:::gate
  C_A1_S16_PauseAtThe -. "empathy_score +1" .-> G_EMPATHY_SCORE_2{"empathy_score >= 2"}:::gate
  C_A1_S16_PickUpThe["Choice: Pick up the photo."]:::choice
  A1_S16_RETU --> C_A1_S16_PickUpThe
  C_A1_S16_PickUpThe -. "empathy_score +1" .-> G_EMPATHY_SCORE_3{"empathy_score >= 3"}:::gate
  C_A1_S16_PickUpThe -. "empathy_score +1" .-> G_EMPATHY_SCORE_1{"empathy_score >= 1"}:::gate
  C_A1_S16_PickUpThe -. "empathy_score +1" .-> G_EMPATHY_SCORE_2{"empathy_score >= 2"}:::gate
  C_A1_S16_LeaveItWhere["Choice: Leave it where it is."]:::choice
  A1_S16_RETU --> C_A1_S16_LeaveItWhere
  C_A1_S16_LeaveItWhere -. "empathy_score -1" .-> G_EMPATHY_SCORE_3{"empathy_score >= 3"}:::gate
  C_A1_S16_LeaveItWhere -. "empathy_score -1" .-> G_EMPATHY_SCORE_1{"empathy_score >= 1"}:::gate
  C_A1_S16_LeaveItWhere -. "empathy_score -1" .-> G_EMPATHY_SCORE_2{"empathy_score >= 2"}:::gate
  C_A1_S16_PrepareThoroughlyPerfect["Choice: Prepare thoroughly — perfect readiness."]:::choice
  A1_S16_RETU --> C_A1_S16_PrepareThoroughlyPerfect
  C_A1_S16_PrepareThoroughlyPerfect -. "empathy_score -1" .-> G_EMPATHY_SCORE_3{"empathy_score >= 3"}:::gate
  C_A1_S16_PrepareThoroughlyPerfect -. "empathy_score -1" .-> G_EMPATHY_SCORE_1{"empathy_score >= 1"}:::gate
  C_A1_S16_PrepareThoroughlyPerfect -. "empathy_score -1" .-> G_EMPATHY_SCORE_2{"empathy_score >= 2"}:::gate
  C_A1_S16_MinimalPreparationEnough["Choice: Minimal preparation — enough to function."]:::choice
  A1_S16_RETU --> C_A1_S16_MinimalPreparationEnough
  C_A1_S16_MinimalPreparationEnough -. "empathy_score +1" .-> G_EMPATHY_SCORE_3{"empathy_score >= 3"}:::gate
  C_A1_S16_MinimalPreparationEnough -. "empathy_score +1" .-> G_EMPATHY_SCORE_1{"empathy_score >= 1"}:::gate
  C_A1_S16_MinimalPreparationEnough -. "empathy_score +1" .-> G_EMPATHY_SCORE_2{"empathy_score >= 2"}:::gate
  C_A1_S17_TakeTheDirect["Choice: Take the direct route—efficient, by-the-book."]:::choice
  A1_S17_THE_ --> C_A1_S17_TakeTheDirect
  C_A1_S17_TakeTheDirect -. "empathy_score -1" .-> G_EMPATHY_SCORE_3{"empathy_score >= 3"}:::gate
  C_A1_S17_TakeTheDirect -. "empathy_score -1" .-> G_EMPATHY_SCORE_1{"empathy_score >= 1"}:::gate
  C_A1_S17_TakeTheDirect -. "empathy_score -1" .-> G_EMPATHY_SCORE_2{"empathy_score >= 2"}:::gate
  C_A1_S17_DetourThroughMarket["Choice: Detour through market—slower, gives them time to hear the approach."]:::choice
  A1_S17_THE_ --> C_A1_S17_DetourThroughMarket
  C_A1_S17_DetourThroughMarket -. "empathy_score +1" .-> G_EMPATHY_SCORE_3{"empathy_score >= 3"}:::gate
  C_A1_S17_DetourThroughMarket -. "empathy_score +1" .-> G_EMPATHY_SCORE_1{"empathy_score >= 1"}:::gate
  C_A1_S17_DetourThroughMarket -. "empathy_score +1" .-> G_EMPATHY_SCORE_2{"empathy_score >= 2"}:::gate
  C_A1_S17_BreachAndClear["Choice: Breach and clear—follow protocol."]:::choice
  A1_S17_THE_ --> C_A1_S17_BreachAndClear
  C_A1_S17_BreachAndClear -. "empathy_score -2" .-> G_EMPATHY_SCORE_3{"empathy_score >= 3"}:::gate
  C_A1_S17_BreachAndClear -. "empathy_score -2" .-> G_EMPATHY_SCORE_1{"empathy_score >= 1"}:::gate
  C_A1_S17_BreachAndClear -. "empathy_score -2" .-> G_EMPATHY_SCORE_2{"empathy_score >= 2"}:::gate
  C_A1_S17_MarkAsClear["Choice: Mark as clear—fake the report."]:::choice
  A1_S17_THE_ --> C_A1_S17_MarkAsClear
  C_A1_S17_MarkAsClear -. "empathy_score +1" .-> G_EMPATHY_SCORE_3{"empathy_score >= 3"}:::gate
  C_A1_S17_MarkAsClear -. "empathy_score +1" .-> G_EMPATHY_SCORE_1{"empathy_score >= 1"}:::gate
  C_A1_S17_MarkAsClear -. "empathy_score +1" .-> G_EMPATHY_SCORE_2{"empathy_score >= 2"}:::gate
  C_A1_S17_EliminateTheTarget["Choice: Eliminate the target—he's in the sweep zone."]:::choice
  A1_S17_THE_ --> C_A1_S17_EliminateTheTarget
  C_A1_S17_EliminateTheTarget -. "empathy_score -1" .-> G_EMPATHY_SCORE_3{"empathy_score >= 3"}:::gate
  C_A1_S17_EliminateTheTarget -. "empathy_score -1" .-> G_EMPATHY_SCORE_1{"empathy_score >= 1"}:::gate
  C_A1_S17_EliminateTheTarget -. "empathy_score -1" .-> G_EMPATHY_SCORE_2{"empathy_score >= 2"}:::gate
  C_A1_S17_OrderHimTo["Choice: Order him to run—give him a chance."]:::choice
  A1_S17_THE_ --> C_A1_S17_OrderHimTo
  C_A1_S17_OrderHimTo -. "empathy_score +1" .-> G_EMPATHY_SCORE_3{"empathy_score >= 3"}:::gate
  C_A1_S17_OrderHimTo -. "empathy_score +1" .-> G_EMPATHY_SCORE_1{"empathy_score >= 1"}:::gate
  C_A1_S17_OrderHimTo -. "empathy_score +1" .-> G_EMPATHY_SCORE_2{"empathy_score >= 2"}:::gate
  C_A1_S17_BreachAndClear2["Choice: Breach and clear—complete the mission."]:::choice
  A1_S17_THE_ --> C_A1_S17_BreachAndClear2
  C_A1_S17_BreachAndClear2 -. "empathy_score -2" .-> G_EMPATHY_SCORE_3{"empathy_score >= 3"}:::gate
  C_A1_S17_BreachAndClear2 -. "empathy_score -2" .-> G_EMPATHY_SCORE_1{"empathy_score >= 1"}:::gate
  C_A1_S17_BreachAndClear2 -. "empathy_score -2" .-> G_EMPATHY_SCORE_2{"empathy_score >= 2"}:::gate
  C_A1_S17_CompromiseWarnThem["Choice: Compromise—warn them, give them time to scatter."]:::choice
  A1_S17_THE_ --> C_A1_S17_CompromiseWarnThem
  C_A1_S17_CompromiseWarnThem -. "empathy_score +2" .-> G_EMPATHY_SCORE_3{"empathy_score >= 3"}:::gate
  C_A1_S17_CompromiseWarnThem -. "empathy_score +2" .-> G_EMPATHY_SCORE_1{"empathy_score >= 1"}:::gate
  C_A1_S17_CompromiseWarnThem -. "empathy_score +2" .-> G_EMPATHY_SCORE_2{"empathy_score >= 2"}:::gate
  C_A1_S18_CallHerBack["Choice: Call her back."]:::choice
  A1_S18B_MORN --> C_A1_S18_CallHerBack
  C_A1_S18_CallHerBack -. "Lyra.affection +1; empathy_score +1" .-> G_EMPATHY_SCORE_3{"empathy_score >= 3"}:::gate
  C_A1_S18_CallHerBack -. "Lyra.affection +1; empathy_score +1" .-> G_EMPATHY_SCORE_1{"empathy_score >= 1"}:::gate
  C_A1_S18_CallHerBack -. "Lyra.affection +1; empathy_score +1" .-> G_EMPATHY_SCORE_2{"empathy_score >= 2"}:::gate
  C_A1_S18_LetHerGo["Choice: Let her go."]:::choice
  A1_S18B_MORN --> C_A1_S18_LetHerGo
  C_A1_S18_LetHerGo -. "empathy_score -1" .-> G_EMPATHY_SCORE_3{"empathy_score >= 3"}:::gate
  C_A1_S18_LetHerGo -. "empathy_score -1" .-> G_EMPATHY_SCORE_1{"empathy_score >= 1"}:::gate
  C_A1_S18_LetHerGo -. "empathy_score -1" .-> G_EMPATHY_SCORE_2{"empathy_score >= 2"}:::gate
  C_A1_S20_InvestigateFurtherCheck["Choice: Investigate further—check historical maintenance patterns."]:::choice
  A1_S20_INVE --> C_A1_S20_InvestigateFurtherCheck
  C_A1_S20_DismissItToo["Choice: Dismiss it—too exhausted to think clearly."]:::choice
  A1_S20_INVE --> C_A1_S20_DismissItToo
  C_A1_S20_KeepDiggingTry["Choice: Keep digging—try to find the full picture."]:::choice
  A1_S20_INVE --> C_A1_S20_KeepDiggingTry
  C_A1_S20_StopInvestigatingToo["Choice: Stop investigating—too exhausted to continue."]:::choice
  A1_S20_INVE --> C_A1_S20_StopInvestigatingToo

  %% === Where gates are read later ===
  A1_S05_GALA --> G_EMPATHY_SCORE_3
  A1_S05_GALA --> G_EMPATHY_SCORE_1
  A1_S05_GALA --> G_EMPATHY_SCORE_2
  A1_S17_THE_ --> G_EMPATHY_SCORE_2
  A1_S18_CONF --> G_EMPATHY_SCORE_2

  %% === Styling ===
  classDef choice fill:#222,stroke:#666,color:#fff;
  classDef gate fill:#111,stroke:#bbb,color:#fff;
  classDef optional fill:#1b2838,stroke:#76a1ff,color:#fff;